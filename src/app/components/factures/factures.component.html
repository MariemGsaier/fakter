<!-- Daily Activity -->
<mat-card class="w-100">
    <mat-card-content>
        <button mat-button class="btn btn-info fw-normal btnw" routerLink="/add-facture" type="submit" matTooltip="Ajouter une facture" matTooltipPosition="above"
            style="float: right">
            <mat-icon>add</mat-icon>
        </button>
        <button
        mat-button
        class="btn btn-primary fw-normal"
        matTooltip="Exporter en Excel" matTooltipPosition="above"
        style="float: right; margin-right: 0.142%"
        (click)="exportexcel()"
      >
      <mat-icon>save_alt</mat-icon>
      </button>
    <h4 class="mb-56" *ngIf="!showObserverBoard">Gérez les factures</h4>
    <h4 class="mb-56" *ngIf="showObserverBoard">Consultez les factures</h4>

        <div class="table-responsive">
            <table mat-table [dataSource]="dataSource" id="excel-table" class="text-nowrap w-100">

                <!-- Id Column -->
                <ng-container matColumnDef="référence">
                    <th mat-header-cell *matHeaderCellDef> Référence </th>
                    <td mat-cell class="fw-medium" *matCellDef="let facture"> {{facture.reference}} </td>
                </ng-container>

                <!-- Assigned Column -->
                <ng-container matColumnDef="créé_par">
                    <th mat-header-cell *matHeaderCellDef> Créé par </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium">{{ creatorFact }}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="client">
                  <th mat-header-cell *matHeaderCellDef> Client </th>
                  <td mat-cell *matCellDef="let facture">
                      <p class="mb-0 fw-medium">{{ facture.client.nom}}</p>
                  </td>
              </ng-container>
                
                <!-- Priority Column -->
                <ng-container matColumnDef="date_facturation">
                    <th mat-header-cell *matHeaderCellDef> Date facturation </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium">{{facture.date_facturation}}  </p>
                    </td>
                </ng-container>

                <!-- Budget Column -->
                <ng-container matColumnDef="date_echeance">
                    <th mat-header-cell *matHeaderCellDef> Date échéance </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium">{{facture.date_echeance}}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="etat_facture">
                    <th mat-header-cell *matHeaderCellDef> Etat facture </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium">{{ facture.etat_facture }}</p>
                    </td>
                </ng-container>

                <!-- Project Column -->
                <ng-container matColumnDef="etat_echeance">
                    <th mat-header-cell *matHeaderCellDef> Etat échéance </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium ">{{facture.etat_echeance}}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="total_ht">
                    <th mat-header-cell *matHeaderCellDef> Total HT </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium ">{{facture.total_ht}}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="total_ttc">
                    <th mat-header-cell *matHeaderCellDef> Total TTC </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium ">{{facture.total_ttc}}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="total_devise">
                    <th mat-header-cell *matHeaderCellDef> Total devise </th>
                    <td mat-cell *matCellDef="let facture">
                        <p class="mb-0 fw-medium ">{{facture.total_devise}}</p>
                    </td>
                </ng-container>
                <ng-container matColumnDef="actions" stickyEnd>
                    <th mat-header-cell *matHeaderCellDef [hidden]="showObserverBoard">Actions</th>
                    <td mat-cell *matCellDef="let facture; let i = index;" [class.active]="i == currentIndex">

                        <button mat-button class="btn btn-success fw-normal btnw" style="margin-right: 1%;"
                            type="submit" (click)="setActiveFacture(facture, i)" *ngIf="!showObserverBoard">
                            <mat-icon>edit</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
    </mat-card-content>
</mat-card>

<mat-card class="w-100" *ngIf="disabelModif">
    <mat-card-content>
      <form>
            <mat-form-field class="w-100 fs-16" appearance="outline">
              <mat-label>Référence </mat-label>
              <input
                matInput
                type="text"
                placeholder="Veuillez entrer votre modification"
                id="référence"
                [(ngModel)]="currentFacture.reference"
                [ngModelOptions]="{ standalone: true }"
              />
            </mat-form-field>
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Créé par </mat-label>
          <input
            matInput
            type="text"
            placeholder="Veuillez entrer votre modification"
            id="créé_par"
            [(ngModel)]="currentFacture.nom_user"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
  
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Date facturation</mat-label>
          <input
            matInput
            type="date"
            placeholder="Veuillez entrer votre modification"
            required
            id="date_facturation"
            [(ngModel)]="currentFacture.date_facturation"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
  
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Date échéance</mat-label>
          <input
            matInput
            type="date"
            placeholder="Veuillez entrer votre modification"
            required
            id="date_echeance"
            [(ngModel)]="currentFacture.date_echeance"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Etat facture</mat-label>
          <input
            matInput
            type="text"
            placeholder="Veuillez entrer votre modification"
            required
            id="etat_facture"
            [(ngModel)]="currentFacture.etat_facture"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Etat échéance</mat-label>
          <input
            matInput
            type="text"
            placeholder="Veuillez entrer votre modification"
            required
            id="etat_echeance"
            [(ngModel)]="currentFacture.etat_echeance"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Total HT</mat-label>
          <input
            matInput
            type="number"
            placeholder="Veuillez entrer votre modification"
            required
            id="total_ht"
            [(ngModel)]="currentFacture.total_ht"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
        <mat-form-field class="w-100 fs-16" appearance="outline">
          <mat-label>Total en chiffres</mat-label>
          <input
            matInput
            type="number"
            placeholder="Veuillez entrer votre modification"
            required
            id="total_chiffres"
            [(ngModel)]="currentFacture.total_ttc"
            [ngModelOptions]="{ standalone: true }"
          />
        </mat-form-field>
          <mat-form-field class="w-100 fs-16" appearance="outline">
            <mat-label>Total devise</mat-label>
            <input
              matInput
              type="number"
              placeholder="Veuillez entrer votre modification"
              required
              id="total_devise"
              [(ngModel)]="currentFacture.total_devise"
              [ngModelOptions]="{ standalone: true }"
            />
          </mat-form-field>
  
        <div>
          &nbsp;
          <button
          mat-button
          class="btn btn-danger fw-normal"
          (click)="annuler()"
          type="submit"
          style="float: right; margin-left: 0.3%;"
        >
          Annuler
        </button>
          <button
            mat-button
            class="btn btn-success fw-normal"
            (click)="updateFacture()"
            type="submit"
            style="float: right"
          >
            Confirmer
          </button>
          <p>{{ message }}</p>
        </div>
      </form>
    </mat-card-content>
  </mat-card>